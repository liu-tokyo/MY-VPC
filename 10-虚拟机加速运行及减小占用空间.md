# 虚拟机加速运行及减小占用空间

## 1. 虚拟机加速运行

- 碎片整理  
  在 SSD 上保存的 虚拟机 也许不是很明显，在 机械硬盘 上运行虚拟机，如果不进行磁盘的 碎片整理 的话，开机速度还是有很明显的区别的。  
  尤其是 WindowsXP，如果没有执行磁盘的 碎片整理，启动后开启资源管理器，很长时间都不能正确加载 磁盘 的各种信息；即使是在 SSD 上也有明显的延迟。

  鉴于 碎片整理 花费较长时间，使用一个具有 GHOST 功能的虚拟机，直接 克隆 该磁盘，也许速度更快。

- 安装最新驱动  
  尤其是虚拟机，没有最新驱动，开机之后，调用 资源管理器 查看资源，依然要等待很长时间。  
  ※ 针对一个启动之后依然查找资源很花费时间的 WindowsXP 的虚拟机，以上手段好像无效。  
  ※ 后续即使对该磁盘进行了 GHOST 磁盘克隆，依然无法改变启动之后查找资源的速度。

## 2. 减小占用空间

### 2.1 磁盘整理功能

- 针对系统启动盘，执行 磁盘整理，最好是整理之后再执行 碎片整理。  

### 2.2 磁盘深度清理

- Window10 及 Windows11  
  使用 Windows 自带的 DISM 指令，针对 WinSXS 目录进行清理。
- 直接使用 DISM++ 进行清理  
  到 Github 下载 DISM++ 的最新版本，这是一个懒汉工具，能够实现更加深度的清理。

### 2.2 磁盘空间清理

- 使用 `SDelete` 清理磁盘空间（清除已经删除，但是依然占用空间的数据）：

  | Windows版本         | SDelete版本    | 备注 |
  | ------------------- | -------------- | ---- |
  | WindowsXP           | `SDelete-2.04` |      |
  | Window7及之后的版本 | `SDelete-2.05` |      |
  | Windows2000         | `SDelete-1.6`  |      |
  
  `SDelete` 的 `-z` 参数，对虚拟机缩减磁盘尺寸非常有效。

### 2.3 磁盘压缩

- 在 VMware 的该虚拟机 的 编辑 界面，选择磁盘，按下 `磁盘压缩` 按钮，稍等之后，就能够看到磁盘文件大小有效变小。  
  该界面上也有 碎片整理 的按钮，针对 WIN10 好像是很有效，但是对于老旧的 WINXP 好像没啥效果。
- VirtualBox 的话，使用命令行，针对 虚拟磁盘 进行压缩。  
  个人都是在 虚拟机 数据目录下面，直接生成一个 批处理 文件进行自动处理。

